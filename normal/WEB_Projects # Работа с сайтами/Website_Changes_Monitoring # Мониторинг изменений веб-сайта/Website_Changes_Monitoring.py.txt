# https://www.geeksforgeeks.org/python-script-to-monitor-website-changes/
# Скрипт для мониторинга изменений веб-сайта. Мониторинг веб-сайта и уведомление, если есть какие-либо изменения

# Importing libraries
import time
import datetime
import hashlib
from urllib.request import urlopen, Request


# setting the URL you want to monitor
url = Request('https://web-master-pro.ru/projects/professionals/',
              headers={'User-Agent': 'Mozilla/5.0'})

# to perform a GET request and load the
# content of the website and store it in a var
response = urlopen(url).read()

# to create the initial hash
currentHash = hashlib.sha224(response).hexdigest()
print("running", currentHash)
time.sleep(10)
while True:
    # Datetime
    n = datetime.datetime.now()
    now = n.strftime('%Y-%m-%d %H:%M:%S')  # ('%Y-%m-%d %H:%M:%S.%f')
    try:
        # perform the get request and store it in a var
        response = urlopen(url).read()

        # create a hash
        currentHash = hashlib.sha224(response).hexdigest()

        # wait for 30 seconds
        time.sleep(30)

        # perform the get request
        response = urlopen(url).read()

        # create a new hash
        newHash = hashlib.sha224(response).hexdigest()

        # check if new hash is same as the previous hash
        if newHash == currentHash:
            continue

        # if something changed in the hashes
        else:
            # notify
            print(now, "\nhttps://web-master-pro.ru/projects/professionals/"
                       "\n!!!something changed!!!")

            # again read the website
            response = urlopen(url).read()

            # create a hash
            currentHash = hashlib.sha224(response).hexdigest()

            # wait for 30 seconds
            time.sleep(30)
            continue

    # To handle exceptions
    except Exception as e:
        print(now, "error")
